#include <stdio.h>
#include <string.h>
#include <stdlib.h>

float data[] = {0.897673879196767,-1.01560199071363,1.33575163424152,1.31336831386084,1.13920048346495,0.131538812050262,1.33575163424152,1.31336831386084,1.38072708773314,-0.327317509055296,1.39239928624498,1.31336831386084,1.50149038986724,-0.0978893485025174,1.27910398223806,1.31336831386084,1.01843718133086,-1.24503015126641,1.33575163424152,1.18203148247476,0.535383972794484,-1.93331463292475,1.16580867823115,1.05069465108867,1.50149038986724,-0.786173830160854,1.33575163424152,1.18203148247476,1.01843718133086,-0.786173830160854,1.27910398223806,1.31336831386084,1.74301699413542,0.360966972603041,1.33575163424152,1.31336831386084,1.13920048346495,-0.0978893485025174,1.27910398223806,1.44470514524693,0.535383972794484,-1.47445831181919,1.27910398223806,1.31336831386084,1.25996378559905,-0.786173830160854,1.22245633023461,1.31336831386084,1.25996378559905,0.131538812050262,1.33575163424152,1.44470514524693,1.86378029626952,0.131538812050262,1.50569459025189,1.44470514524693,0.0523307642581091,-2.16274279347753,1.44904693824844,1.31336831386084,0.173094066392203,-3.08045543568864,1.27910398223806,1.05069465108867,0.535383972794484,-1.93331463292475,1.39239928624498,1.05069465108867,0.897673879196767,-1.01560199071363,1.33575163424152,1.18203148247476,0.173094066392203,-1.70388647237197,1.16580867823115,1.18203148247476,0.897673879196767,-1.70388647237197,1.27910398223806,1.18203148247476,0.535383972794484,-0.786173830160854,1.16580867823115,1.31336831386084,0.897673879196767,-1.47445831181919,1.27910398223806,1.05069465108867,1.50149038986724,-1.24503015126641,1.56234224225535,1.31336831386084,0.897673879196767,-0.556745669608074,1.16580867823115,0.919357819702591,1.25996378559905,-0.786173830160854,1.05251337422424,1.31336831386084,1.01843718133086,0.131538812050262,1.22245633023461,1.31336831386084,1.01843718133086,-0.786173830160854,1.22245633023461,1.05069465108867,0.776910577062673,-1.01560199071363,1.27910398223806,1.31336831386084,0.776910577062673,-0.786173830160854,1.33575163424152,1.31336831386084,1.38072708773314,-0.327317509055296,1.22245633023461,1.31336831386084,1.25996378559905,-0.0978893485025174,1.22245633023461,1.31336831386084,0.535383972794484,-0.786173830160854,1.27910398223806,1.05069465108867,0.776910577062673,-2.3921709540303,1.27910398223806,1.44470514524693,0.414620670660391,-2.62159911458309,1.33575163424152,1.31336831386084,1.13920048346495,-0.0978893485025174,1.27910398223806,1.31336831386084,1.01843718133086,-0.327317509055296,1.44904693824844,1.31336831386084,0.414620670660391,-1.01560199071363,1.39239928624498,1.31336831386084,1.13920048346495,-1.24503015126641,1.33575163424152,1.44470514524693,1.74301699413542,0.131538812050262,1.39239928624498,1.31336831386084,0.897673879196767,-0.786173830160854,1.27910398223806,1.31336831386084,1.01843718133086,-1.01560199071363,1.39239928624498,1.18203148247476,1.62225369200133,1.73753593591971,1.39239928624498,1.18203148247476,1.74301699413542,-0.327317509055296,1.39239928624498,1.31336831386084,1.01843718133086,-1.01560199071363,1.22245633023461,0.788020988316507,0.897673879196767,-1.70388647237197,1.05251337422424,1.05069465108867,1.25996378559905,0.131538812050262,1.33575163424152,1.18203148247476,0.897673879196767,-1.70388647237197,1.22245633023461,1.31336831386084,1.50149038986724,-0.327317509055296,1.33575163424152,1.31336831386084,0.656147274928579,-1.47445831181919,1.27910398223806,1.31336831386084,1.01843718133086,-0.556745669608074,1.33575163424152,1.31336831386084,-1.39682886135102,-0.327317509055296,-0.533620881872565,-0.262673662772167,-0.672249048546455,-0.327317509055296,-0.420325577865651,-0.394010494158252,-1.27606555921693,-0.0978893485025174,-0.646916185879479,-0.394010494158252,0.414620670660391,1.73753593591971,-0.137087317848365,-0.131336831386083,-0.793012350680549,0.59039513315582,-0.476973229869108,-0.394010494158252,0.173094066392203,0.59039513315582,-0.420325577865651,-0.131336831386083,-0.551485746412361,-0.556745669608074,-0.533620881872565,-0.525347325544336,1.13920048346495,1.50810777536693,0.259446246175835,0.26267366277217,-0.913775652814643,0.360966972603041,-0.476973229869108,-0.131336831386083,0.776910577062673,0.819823293708598,-0.0804396658449076,-0.262673662772167,1.01843718133086,2.42582041757805,0.146150942168921,0.26267366277217,-0.0684325378759855,0.131538812050262,-0.250382621855279,-0.394010494158252,-0.189195840010079,1.96696409647249,-0.137087317848365,0.26267366277217,-0.309959142144173,0.360966972603041,-0.533620881872565,-0.262673662772167,0.293857368526297,0.360966972603041,0.0895032901654638,-0.131336831386083,-1.03453895494874,-0.0978893485025174,-0.363677925862194,-0.262673662772167,0.293857368526297,0.131538812050262,-0.420325577865651,-0.394010494158252,0.0523307642581091,0.819823293708598,-0.193734969851822,0.26267366277217,-0.430722444278267,1.96696409647249,-0.420325577865651,-0.394010494158252,0.293857368526297,1.27867961481416,-0.0804396658449076,0.131336831386085,-0.0684325378759855,-0.327317509055296,-0.590268533876022,-0.788020988316504,-0.309959142144173,0.59039513315582,-0.137087317848365,-0.131336831386083,-0.551485746412361,1.27867961481416,-0.646916185879479,-0.394010494158252,-0.309959142144173,0.59039513315582,-0.533620881872565,0.00000000000000116650539348914,-0.672249048546455,0.360966972603041,-0.307030273858736,-0.131336831386083,-0.913775652814643,0.131538812050262,-0.363677925862194,-0.262673662772167,-1.15530225708283,0.59039513315582,-0.590268533876022,-0.262673662772167,-1.03453895494874,0.131538812050262,-0.703563837882936,-0.65668415693042,-0.189195840010079,0.360966972603041,-0.420325577865651,-0.394010494158252,0.173094066392203,1.04925145426138,0.146150942168921,0.26267366277217,0.414620670660391,1.50810777536693,-0.0237920138414504,0.131336831386085,0.414620670660391,1.50810777536693,0.0328556381620066,0.26267366277217,0.0523307642581091,0.819823293708598,-0.0804396658449076,0.00000000000000116650539348914,-0.189195840010079,0.819823293708598,-0.760211489886393,-0.525347325544336,0.535383972794484,0.131538812050262,-0.420325577865651,-0.394010494158252,-0.189195840010079,-0.786173830160854,-0.420325577865651,-0.525347325544336,-1.03453895494874,-0.0978893485025174,-0.533620881872565,-0.394010494158252,-0.551485746412361,1.73753593591971,-0.363677925862194,-0.131336831386083,0.293857368526297,0.131538812050262,-0.193734969851822,-0.131336831386083,0.414620670660391,1.27867961481416,-0.137087317848365,-0.131336831386083,0.414620670660391,1.04925145426138,-0.363677925862194,0.00000000000000116650539348914,-0.309959142144173,0.131538812050262,-0.476973229869108,-0.262673662772167,0.0523307642581091,1.04925145426138,-0.137087317848365,0.00000000000000116650539348914,1.01843718133086,1.73753593591971,0.259446246175835,0.26267366277217,0.293857368526297,0.819823293708598,-0.250382621855279,-0.131336831386083,0.173094066392203,0.131538812050262,-0.250382621855279,0.00000000000000116650539348914,0.173094066392203,0.360966972603041,-0.250382621855279,-0.131336831386083,-0.430722444278267,0.360966972603041,-0.307030273858736,-0.131336831386083,0.897673879196767,1.27867961481416,0.429389202186207,0.131336831386085,0.173094066392203,0.59039513315582,-0.193734969851822,-0.131336831386083,-0.551485746412361,-0.556745669608074,-1.27004035791751,-1.70737880801909,0.0523307642581091,0.819823293708598,-0.760211489886393,-0.919357819702588,-1.51759216348511,0.131538812050262,-1.21339270591405,-1.18203148247476,-0.551485746412361,0.360966972603041,-1.04344974990368,-0.788020988316504,-0.793012350680549,0.131538812050262,-1.15674505391059,-1.31336831386084,-2.12140867415558,0.131538812050262,-1.60992626993825,-1.18203148247476,1.13920048346495,1.27867961481416,-0.420325577865651,-0.65668415693042,-1.7591187677533,0.360966972603041,-1.43998331392788,-0.788020988316504,-1.03453895494874,1.27867961481416,-1.15674505391059,-0.788020988316504,-1.63835546561921,-1.24503015126641,-1.32668800992096,-1.70737880801909,-0.793012350680549,-0.327317509055296,-0.760211489886393,-1.05069465108867,-0.672249048546455,0.819823293708598,-0.873506793893308,-0.919357819702588,-1.15530225708283,0.131538812050262,-0.986802097900222,-1.18203148247476,0.173094066392203,1.27867961481416,-0.703563837882936,-1.05069465108867,0.0523307642581091,0.59039513315582,-0.760211489886393,-1.57604197663301,-0.672249048546455,-0.327317509055296,-0.873506793893308,-1.44470514524693,-0.793012350680549,0.131538812050262,-0.986802097900222,-0.788020988316504,-2.24217197628968,-1.70388647237197,-1.66657392194171,-1.31336831386084,-2.24217197628968,1.04925145426138,-1.77986922594862,-1.44470514524693,-0.189195840010079,1.96696409647249,-0.703563837882936,-0.394010494158252,-1.27606555921693,-0.327317509055296,-1.10009740190714,-1.44470514524693,0.293857368526297,0.59039513315582,-0.646916185879479,-1.05069465108867,-2.24217197628968,0.59039513315582,-1.66657392194171,-1.05069465108867,-0.551485746412361,0.819823293708598,-0.646916185879479,-0.788020988316504,-1.03453895494874,-0.556745669608074,-1.10009740190714,-1.18203148247476,-1.63835546561921,-0.327317509055296,-1.27004035791751,-0.788020988316504,-0.430722444278267,0.59039513315582,-0.590268533876022,-0.788020988316504,-0.309959142144173,0.131538812050262,-0.646916185879479,-0.788020988316504,-0.672249048546455,0.59039513315582,-1.04344974990368,-1.18203148247476,-1.63835546561921,0.131538812050262,-1.15674505391059,-0.525347325544336,-1.8798820698874,0.59039513315582,-1.32668800992096,-0.919357819702588,-2.48369858055787,-1.70388647237197,-1.49663096593134,-1.05069465108867,-0.672249048546455,0.59039513315582,-1.04344974990368,-1.31336831386084,-0.551485746412361,0.59039513315582,-0.760211489886393,-0.394010494158252,-0.309959142144173,1.04925145426138,-1.04344974990368,-0.262673662772167,-2.24217197628968,0.131538812050262,-1.32668800992096,-1.44470514524693,-0.551485746412361,-0.786173830160854,-1.04344974990368,-1.57604197663301,-0.672249048546455,-0.0978893485025174,-0.986802097900222,-0.788020988316504,-0.189195840010079,0.131538812050262,-0.590268533876022,-0.788020988316504,-1.27606555921693,-0.0978893485025174,-0.930154445896765,-1.18203148247476,-1.03453895494874,-0.0978893485025174,-1.04344974990368,-1.57604197663301,-1.27606555921693,-0.0978893485025174,-0.760211489886393,-1.44470514524693,0.0523307642581091,0.819823293708598,-0.760211489886393,-0.919357819702588,-1.15530225708283,-0.327317509055296,-1.21339270591405,-1.44470514524693,-1.03453895494874,-0.556745669608074,-1.10009740190714,-1.70737880801909,-1.03453895494874,0.131538812050262,-0.816859141889851,-1.44470514524693,-0.551485746412361,1.27867961481416,-0.703563837882936,-0.919357819702588,-0.793012350680549,0.131538812050262,-0.816859141889851,-1.05069465108867,-0.430722444278267,-0.786173830160854,-0.930154445896765,-1.44470514524693,-0.0684325378759855,0.131538812050262,-0.760211489886393,-0.788020988316504};

int output[] = {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3};

float val_data[128];
int val_output[32];

float trn_data[472];
int trn_output[118];

int main(int argc, char **argv) {
	FILE* miniBatch;
	float mb = 32.0;
	int b = 0;
	int i = 0;
	int r;

	float hot = 1.0f;
	float not = 0.0f;


	float tempData;
	int tempOutput;

	char dataPath[10] = "./data/\0\0\0";
	char testPath[10] = "./test/\0\0\0";

	// mix up list
	int mix = 100;
	while (mix--) {
		i = 150;
		while (i--) {
			tempData = data[i];
			tempOutput = output[i];

			// pick random index to swap with
			r = i;
			while (r == i) r = rand() % 150;

			data[i] = data[r];
			output[i] = output[r];

			data[r] = tempData;
			output[r] = tempOutput;
		}
	}

	// seperate into training and validation sets
	i = 118;
	while (i--) {
		mix = i * 4;
		trn_data[mix] = data[mix];
		mix++;
		trn_data[mix] = data[mix];
		mix++;
		trn_data[mix] = data[mix];
		mix++;
		trn_data[mix] = data[mix];
		trn_output[i] = output[i];
	}
	i = 150;
	while (i-- > 118) {
		mix = i * 4;
		val_data[mix - 472] = data[mix];
		mix++;
		val_data[mix - 472] = data[mix];
		mix++;
		val_data[mix - 472] = data[mix];
		mix++;
		val_data[mix - 472] = data[mix];
		val_output[i] = output[i];
	}

	printf("Splitting training data into minibatches...\n");
	
	// generate minibatches
	for (b = 0; b < 86; b++) {
		sprintf(&dataPath[7], "%d", b);
		miniBatch = fopen(dataPath, "wb");
		fwrite(&mb, sizeof mb, 1, miniBatch); // write minibatch size

		// write single minibatch to disk
		for (i = 0; i < 128; i++) {
			fwrite(&trn_data[i+b], sizeof mb, 1, miniBatch);
		}
		// write minibatch expected output
		for (i = 0; i < 32; i++) {
			for (int e = 0; e < 3; e++) {
				fwrite((e != trn_output[i+b]) ? &not : &hot, sizeof mb, 1, miniBatch);
			}
		}
		fclose(miniBatch);
	}

	printf("Splitting validation data into minibatches...\n");
		sprintf(&testPath[7], "%d", 0);
		miniBatch = fopen(testPath, "wb");
		fwrite(&mb, sizeof mb, 1, miniBatch); // write minibatch size

		for (i = 0; i < 128; i++) {
			fwrite(&val_data[i], sizeof mb, 1, miniBatch);
		}
		for (i = 0; i < 32; i++) {
			for (int e = 0; e < 3; e++) {
				fwrite((e != val_output[i]) ? &not : &hot, sizeof mb, 1, miniBatch);
			}
		}

		fclose(miniBatch);
}